# frozen_string_literal: true

class BlockSerializer < ActiveModel::Serializer
  attributes :version
  attribute :block_hash, key: :hash
  attributes :header, :body

  # rpc getTransaction params: [hash, flag]
  #
  # if flag set true, output transaction hash and content.
  # {
  #     "transactions" => [
  #         [0] {
  #                "hash" => "0x8b7e42fcad25542abf963e8ba3f15b7f9f5ca7ba9a97117a99d959d44a85b114",
  #             "content" => "0x0a9608120f37353666393331636662396461353218c0843d20880f2ad7076060604052341561000f57600080fd5b6040516020806103b783398101604052808051906020019091905050806000803373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002081905550506103398061007e6000396000f30060606040526004361061004c576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806370a0823114610051578063a9059cbb1461009e575b600080fd5b341561005c57600080fd5b610088600480803573ffffffffffffffffffffffffffffffffffffffff169060200190919050506100e0565b6040518082815260200191505060405180910390f35b34156100a957600080fd5b6100de600480803573ffffffffffffffffffffffffffffffffffffffff169060200190919080359060200190919050506100f8565b005b60006020528060005260406000206000915090505481565b806000803373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020541015151561014557600080fd5b6000808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054816000808573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205401101515156101d257600080fd5b806000803373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008282540392505081905550806000808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825401925050819055507fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef338383604051808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001828152602001935050505060405180910390a150505600a165627a7a72305820b725c7e03637d8119d73a6927edde2ea8ee768ec0f8136cb7f6dc6ed4c892ff3002900000000000000000000000000000000000000000000000000000000000f4240322000000000000000000000000000000000000000000000000000000000000000003801124166aad022abb4fd9b803ae40960432bbaa383906c3c7b13c4db4adb9f62e6d9f10f4c745e03a0954337dfd8b2419f414ba1a97cc3cc523146318f16279cf2be9301"
  #         }
  #     ]
  # }
  #
  # if flag set false, output transaction hash only.
  # {
  #    "transactions" => [
  #      "0x8b7e42fcad25542abf963e8ba3f15b7f9f5ca7ba9a97117a99d959d44a85b114"
  #    ]
  # }
  def body
    flag = @instance_options[:flag]
    if flag
      object.body
    else
      { transactions: object.body["transactions"].map { |t| t["hash"] } }
    end
  end
end
